---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import {Image} from '@astrojs/image/components';
import Giscus from '@giscus/svelte';

export interface Props {
	content: {
		title: string;
		description: string;
		date?: string;
		updatedDate?: string;
		heroImage?: string;
		tags: string[];
		nocomments?: boolean;
	};
}

const {
	content: { title, description, date, updatedDate, heroImage, tags, nocomments },
} = Astro.props as Props;


// Match the `heroImage` frontmatter string to its correct
// Astro.glob() import of the file in the src/ directory.
const assets = await Astro.glob('../assets/**/*');
const heroImageAsset = assets.find(asset => {
	if (!heroImage) {
		return false;
	}
	if (!asset.default?.src) {
		return false;
	}
	const index = asset.default.src.indexOf('/assets/');
	return asset.default.src.slice(index) === heroImage;
});

let formatted_date;
if (date) {
	formatted_date = new Date(date).toLocaleDateString('en-us', {
									year: 'numeric',
									month: 'short',
									day: 'numeric',
								})
}
	
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			.title {
				font-size: 2em;
				margin: 0.25em 0 0;
			}
			hr {
				border-top: 1px solid #DDD;
				margin: 1rem 0;
			}
		</style>
	</head>

	<body>
		<Header />
		<main>
			{heroImageAsset && (
				<Image
					width={720}
					height={360}
					src={heroImageAsset.default}
					alt="Hero image"
				/>
			)}
			<h1 class="title">{title}</h1>
			{formatted_date && <time>{formatted_date}</time>}
			{updatedDate && <div>Last updated on <time>{updatedDate}</time></div>}
			<br/>
			Tags: {tags.map((tag) => <a class="tag" href={`/tags/${tag}`}>{tag} </a> )}
			<hr/>
			<article>
				<slot />
			</article>
		</main>
		{!nocomments && 
			<hr />
			<Giscus client:idle
				id="comments"
				repo="animafps/blog"
				repoId="R_kgDOGXvqXg"
				category="Page Comments"
				categoryId="DIC_kwDOGXvqXs4CBEoO"
				mapping="title"
				strict="0"
				reactionsEnabled="1"
				emitMetadata="0"
				inputPosition="top"
				theme="transparent_dark"
				lang="en"
			></Giscus>
		}
		<Footer />
	</body>
</html>
