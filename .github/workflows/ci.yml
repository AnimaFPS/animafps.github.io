name: Continuous Integration

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  Links:
    name: Broken Links
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Project
        uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # renovate: tag=v2
      - name: Use Node.js v16
        uses: actions/setup-node@1f8c6b94b26d0feae1e387ca63ccbdc44d27b561 # renovate: tag=v2
        with:
          node-version: 16
          registry-url: https://registry.npmjs.org/
      - name: Wait for CF Pages
        id: cf-pages
        uses: WalshyDev/cf-pages-await@v1
        with:
          accountEmail: ${{ secrets.CF_ACCOUNT_EMAIL  }}
          apiKey: ${{ secrets.CF_API_KEY  }}
          accountId: '1d4cf1294df33e0483fffa84550d3052'
          project: 'blog'
      - name: Run BLC
        run: npx blc -ro -f '${{ steps.cf-pages.outputs.url}}'

  A11y:
    name: A11y
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Project
        uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579 # renovate: tag=v2
      - name: Use Node.js v16
        uses: actions/setup-node@1f8c6b94b26d0feae1e387ca63ccbdc44d27b561 # renovate: tag=v2
        with:
          node-version: 16
          registry-url: https://registry.npmjs.org/
      - name: Wait for CF Pages
        id: cf-pages
        uses: WalshyDev/cf-pages-await@v1
        with:
          accountEmail: ${{ secrets.CF_ACCOUNT_EMAIL  }}
          apiKey: ${{ secrets.CF_API_KEY  }}
          accountId: '1d4cf1294df33e0483fffa84550d3052'
          project: 'blog'
      - name: Run pa11ly-ci
        run: npx pa11y-ci --sitemap '${{ steps.cf-pages.outputs.url}}/sitemap.xml' --sitemap-find 'https://animafps.xyz' --sitemap-replace '${{ steps.cf-pages.outputs.url}}' 
